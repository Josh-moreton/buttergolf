# Tamagui Config Migration - Before & After

## Summary

This document shows the concrete changes made during the migration of Tamagui config imports from `@buttergolf/ui` to `@buttergolf/config`.

## Files Changed

### 1. Provider Components

#### packages/app/src/provider/Provider.tsx

**Before:**
```tsx
// Import config BEFORE importing TamaguiProvider to ensure createTamagui runs first
import { config } from "@buttergolf/ui";
import type { PropsWithChildren } from "react";
import { useColorScheme } from "react-native";
import { TamaguiProvider, type TamaguiProviderProps } from "tamagui";
```

**After:**
```tsx
// Import config BEFORE importing TamaguiProvider to ensure createTamagui runs first
import { config } from "@buttergolf/config";
import type { PropsWithChildren } from "react";
import { useColorScheme } from "react-native";
import { TamaguiProvider, type TamaguiProviderProps } from "tamagui";
```

#### packages/app/src/provider/NextTamaguiProvider.tsx

**Before:**
```tsx
"use client";

import "@tamagui/core/reset.css";
import "@tamagui/font-inter/css/400.css";
import "@tamagui/font-inter/css/700.css";
import "@tamagui/polyfill-dev";

import type { ReactNode } from "react";
import { StyleSheet } from "react-native";
import { useServerInsertedHTML } from "next/navigation";
import { NextThemeProvider, useRootTheme } from "@tamagui/next-theme";
import { config } from "@buttergolf/ui";

import { Provider } from "./Provider";
```

**After:**
```tsx
"use client";

import "@tamagui/core/reset.css";
import "@tamagui/font-inter/css/400.css";
import "@tamagui/font-inter/css/700.css";
import "@tamagui/polyfill-dev";

import type { ReactNode } from "react";
import { StyleSheet } from "react-native";
import { useServerInsertedHTML } from "next/navigation";
import { NextThemeProvider, useRootTheme } from "@tamagui/next-theme";
import { config } from "@buttergolf/config";

import { Provider } from "./Provider";
```

### 2. Deprecation Notice

#### packages/ui/tamagui.config.ts

**Before:**
```typescript
// DEPRECATED: Do not edit this file.
// The Tamagui config source of truth lives in `packages/config/src/tamagui.config.ts`.
// This file exists only as a thin re-export for backward compatibility.
export { config } from '@buttergolf/config'
export type { AppConfig } from '@buttergolf/config'
export { config as default } from '@buttergolf/config'
```

**After:**
```typescript
/**
 * @deprecated This re-export shim is deprecated and will be removed in a future release.
 * 
 * MIGRATION NOTICE:
 * Please import directly from @buttergolf/config instead:
 * 
 *   Before: import { config } from "@buttergolf/ui"
 *   After:  import { config } from "@buttergolf/config"
 * 
 * The source of truth for Tamagui configuration lives in:
 *   packages/config/src/tamagui.config.ts
 * 
 * This file exists only for backward compatibility and will be removed after
 * all consumers have migrated to the new import path.
 */

// Emit a development-time warning to help developers migrate
if (process.env.NODE_ENV === 'development') {
  console.warn(
    '[DEPRECATION WARNING] Importing Tamagui config from "@buttergolf/ui" is deprecated.\n' +
    'Please update your imports to use "@buttergolf/config" instead.\n' +
    'See packages/config/src/tamagui.config.ts for the source of truth.'
  );
}

// DEPRECATED: Do not edit this file.
// The Tamagui config source of truth lives in `packages/config/src/tamagui.config.ts`.
// This file exists only as a thin re-export for backward compatibility.
export { config } from '@buttergolf/config'
export type { AppConfig } from '@buttergolf/config'
export { config as default } from '@buttergolf/config'
```

### 3. Documentation Updates

#### packages/ui/README.md

**Before (Theme System section):**
```markdown
## üé® Theme System

### Using Themes

```tsx
import { TamaguiProvider, Theme } from '@buttergolf/ui'
import { config } from '@buttergolf/ui'

function App() {
  return (
    <TamaguiProvider config={config} defaultTheme="light">
      {/* Your app */}
    </TamaguiProvider>
  )
}
```
```

**After (Theme System section):**
```markdown
## üé® Theme System

### Tamagui Configuration

**Important**: The Tamagui configuration source of truth lives in `@buttergolf/config`, not `@buttergolf/ui`.

```tsx
// ‚úÖ Correct - Import config from @buttergolf/config
import { config } from '@buttergolf/config'
import { TamaguiProvider } from '@buttergolf/ui'

function App() {
  return (
    <TamaguiProvider config={config} defaultTheme="light">
      {/* Your app */}
    </TamaguiProvider>
  )
}
```

```tsx
// ‚ùå Deprecated - Do not import config from @buttergolf/ui
import { config } from '@buttergolf/ui' // This is deprecated!
```

### Using Themes

```tsx
import { TamaguiProvider, Theme } from '@buttergolf/ui'
import { config } from '@buttergolf/config'

function App() {
  return (
    <TamaguiProvider config={config} defaultTheme="light">
      {/* Your app */}
    </TamaguiProvider>
  )
}
```
```

### 4. ESLint Configuration

#### packages/eslint-config/base.js

**Added Rule:**
```javascript
{
  rules: {
    // Prevent importing Tamagui config from @buttergolf/ui (deprecated)
    "no-restricted-imports": [
      "error",
      {
        patterns: [
          {
            group: ["@buttergolf/ui/tamagui.config*"],
            message:
              "Import Tamagui config from '@buttergolf/config' instead of '@buttergolf/ui/tamagui.config'. The config source of truth lives in packages/config/src/tamagui.config.ts",
          },
        ],
        paths: [
          {
            name: "@buttergolf/ui",
            importNames: ["config"],
            message:
              "Import Tamagui config from '@buttergolf/config' instead of '@buttergolf/ui'. Use: import { config } from '@buttergolf/config'",
          },
        ],
      },
    ],
  },
}
```

### 5. CI Workflow

#### .github/workflows/check-tamagui-config-imports.yml

**New File Created** - Checks for deprecated imports on every PR and push to main/develop branches.

## Verification Results

### ‚úÖ No Deprecated Imports Found
```bash
$ grep -r "import.*config.*from.*@buttergolf/ui" --include="*.ts" --include="*.tsx"
# (Excluding tamagui.config.ts, .md files, and eslint-config)
# Result: No matches found
```

### ‚úÖ ESLint Rule Working
```bash
$ echo 'import { config } from "@buttergolf/ui";' | npx eslint --stdin
# Result: Warning about restricted import with helpful message
```

### ‚úÖ CI Check Passing
```bash
$ bash .github/workflows/check-tamagui-config-imports.yml
# Result: ‚úÖ No deprecated Tamagui config imports found!
```

### ‚úÖ Web Build Successful
```bash
$ pnpm --filter web build
# Result: Build completed successfully
```

### ‚úÖ Configuration Files Verified
- `apps/web/next.config.js` - Includes `@buttergolf/config` in `transpilePackages`
- `apps/mobile/babel.config.js` - Points to correct config path

## Migration Impact

### Benefits
1. **Single Source of Truth**: All imports now point to the same config file
2. **Prevented Duplicate Instances**: No risk of multiple Tamagui instances causing runtime errors
3. **Clear Architecture**: Separation of concerns - UI package no longer hosts configuration
4. **Automated Enforcement**: ESLint + CI prevent accidental regressions
5. **Developer Experience**: Clear warnings and helpful error messages guide migration

### Breaking Changes
None - The re-export shim maintains backward compatibility. The deprecation warnings only appear in development mode.

### Next Steps
1. Monitor deprecation warnings during development
2. After one release cycle, create a follow-up PR to remove the shim completely
3. Continue enforcing the pattern through ESLint and CI

## Testing Checklist

- [x] All code imports updated
- [x] Web app builds successfully
- [x] ESLint rule catches violations
- [x] CI check passes
- [x] Documentation updated
- [x] Deprecation warnings added
- [x] Configuration files verified

## Related Files

- Source of truth: `packages/config/src/tamagui.config.ts`
- Documentation: `docs/TAMAGUI_CONFIG_MIGRATION_COMPLETE.md`
- ESLint config: `packages/eslint-config/base.js`
- CI workflow: `.github/workflows/check-tamagui-config-imports.yml`
