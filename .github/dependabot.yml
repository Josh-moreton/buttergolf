# =============================================================================
# Dependabot Configuration for ButterGolf Monorepo
# =============================================================================
#
# STRATEGY: Aligns with pnpm-workspace.yaml tiered versioning
#
# TIER 1 (IGNORED): Framework-critical packages - manual upgrades only
#   - React, React Native, Expo, Tamagui, Next.js, Solito
#   - These are pinned to exact versions and should NEVER be auto-upgraded
#
# TIER 2 (GROUPED): Patch-safe packages - auto PRs allowed
#   - Prisma, Clerk, TypeScript types
#   - Updates are grouped by concern for easier review
#
# TIER 3 (AUTO): Utility packages - standard auto-update
#   - General utilities with stable APIs
# =============================================================================

version: 2
updates:
  # ===========================================================================
  # Root Workspace
  # ===========================================================================
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "America/New_York"
    open-pull-requests-limit: 5
    commit-message:
      prefix: "chore(deps)"
    labels:
      - "dependencies"
      - "automerge-safe"
    # TIER 1: Never auto-upgrade these (pinned in catalog)
    ignore:
      - dependency-name: "react"
      - dependency-name: "react-dom"
    groups:
      dev-dependencies:
        patterns:
          - "prettier"
          - "turbo"
          - "tsx"

  # ===========================================================================
  # Web App (Next.js)
  # ===========================================================================
  - package-ecosystem: "npm"
    directory: "/apps/web"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "America/New_York"
    open-pull-requests-limit: 5
    commit-message:
      prefix: "chore(deps)"
    labels:
      - "dependencies"
      - "web"
    # TIER 1: Pinned packages - manual upgrades only
    ignore:
      - dependency-name: "next"
      - dependency-name: "@next/*"
      - dependency-name: "react"
      - dependency-name: "react-dom"
      - dependency-name: "tamagui"
      - dependency-name: "@tamagui/*"
    # TIER 2: Grouped for review
    groups:
      clerk:
        patterns:
          - "@clerk/*"
          - "svix"
      types:
        patterns:
          - "@types/*"

  # ===========================================================================
  # Mobile App (Expo)
  # ===========================================================================
  - package-ecosystem: "npm"
    directory: "/apps/mobile"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "America/New_York"
    open-pull-requests-limit: 5
    commit-message:
      prefix: "chore(deps)"
    labels:
      - "dependencies"
      - "mobile"
    # TIER 1: Expo ecosystem - requires coordinated upgrades
    # See: pnpm run deps:upgrade -- --expo
    ignore:
      - dependency-name: "expo"
      - dependency-name: "expo-*"
      - dependency-name: "react-native"
      - dependency-name: "react-native-*"
      - dependency-name: "@react-native/*"
      - dependency-name: "react"
      - dependency-name: "tamagui"
      - dependency-name: "@tamagui/*"
    # TIER 2: Safe to update
    groups:
      clerk:
        patterns:
          - "@clerk/*"
      navigation:
        patterns:
          - "@react-navigation/*"

  # ===========================================================================
  # UI Package
  # ===========================================================================
  - package-ecosystem: "npm"
    directory: "/packages/ui"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "America/New_York"
    open-pull-requests-limit: 3
    commit-message:
      prefix: "chore(deps)"
    labels:
      - "dependencies"
      - "ui"
    # TIER 1: Tamagui - all packages must update together
    ignore:
      - dependency-name: "tamagui"
      - dependency-name: "@tamagui/*"
      - dependency-name: "react"
      - dependency-name: "react-native"

  # ===========================================================================
  # Database Package (Prisma)
  # ===========================================================================
  - package-ecosystem: "npm"
    directory: "/packages/db"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "America/New_York"
    open-pull-requests-limit: 3
    commit-message:
      prefix: "chore(deps)"
    labels:
      - "dependencies"
      - "database"
    # Prisma is TIER 2 - patch updates OK
    groups:
      prisma:
        patterns:
          - "prisma"
          - "@prisma/*"

  # ===========================================================================
  # App Package (Shared Features)
  # ===========================================================================
  - package-ecosystem: "npm"
    directory: "/packages/app"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "America/New_York"
    open-pull-requests-limit: 3
    commit-message:
      prefix: "chore(deps)"
    labels:
      - "dependencies"
    # TIER 1: Cross-platform packages
    ignore:
      - dependency-name: "solito"
      - dependency-name: "tamagui"
      - dependency-name: "@tamagui/*"
      - dependency-name: "react"
      - dependency-name: "react-native"
      - dependency-name: "react-native-web"

  # ===========================================================================
  # Config Package
  # ===========================================================================
  - package-ecosystem: "npm"
    directory: "/packages/config"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "America/New_York"
    open-pull-requests-limit: 3
    commit-message:
      prefix: "chore(deps)"
    labels:
      - "dependencies"
    # TIER 1: Tamagui config
    ignore:
      - dependency-name: "tamagui"
      - dependency-name: "@tamagui/*"

  # ===========================================================================
  # GitHub Actions
  # ===========================================================================
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "monthly"
    open-pull-requests-limit: 5
    commit-message:
      prefix: "chore(ci)"
    labels:
      - "dependencies"
      - "ci"
