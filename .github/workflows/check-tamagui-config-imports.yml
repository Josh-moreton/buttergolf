name: Check Tamagui Config Imports

on:
  pull_request:
    paths:
      - 'apps/**/*.{ts,tsx,js,jsx}'
      - 'packages/**/*.{ts,tsx,js,jsx}'
  push:
    branches:
      - main
      - develop

jobs:
  check-imports:
    name: Verify no config imports from @buttergolf/ui
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check for config imports from @buttergolf/ui
        run: |
          set -e
          echo "Checking for incorrect Tamagui config imports..."
          
          # Define the pattern to search for
          UI_PACKAGE_PATTERN='@buttergolf/ui'
          
          # Check for deep path imports like @buttergolf/ui/tamagui.config
          echo "Checking for deep path imports..."
          DEEP_PATH_IMPORTS=$(grep -r "from ['\"]${UI_PACKAGE_PATTERN}/tamagui\.config" \
            --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" \
            --exclude-dir=node_modules --exclude-dir=.git --exclude-dir=dist \
            . || true)
          
          # Check for named config imports from @buttergolf/ui
          echo "Checking for named config imports..."
          NAMED_IMPORTS=$(grep -r "import.*{.*config.*}.*from ['\"]${UI_PACKAGE_PATTERN}['\"]" \
            --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" \
            --exclude-dir=node_modules --exclude-dir=.git --exclude-dir=dist \
            . || true)
          
          # Report findings
          if [ -n "$DEEP_PATH_IMPORTS" ]; then
            echo "❌ ERROR: Found incorrect deep path imports of Tamagui config:"
            echo "$DEEP_PATH_IMPORTS"
            echo ""
            echo "Config must be imported from @buttergolf/config:"
            echo '  import { config } from "@buttergolf/config"'
            exit 1
          fi
          
          if [ -n "$NAMED_IMPORTS" ]; then
            echo "❌ ERROR: Found incorrect imports of config from @buttergolf/ui:"
            echo "$NAMED_IMPORTS"
            echo ""
            echo "Config is not exported from @buttergolf/ui. Use @buttergolf/config instead:"
            echo '  import { config } from "@buttergolf/config"'
            exit 1
          fi
          
          echo "✅ No incorrect Tamagui config imports found!"
